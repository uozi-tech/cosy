import{G as nt}from"./GoroutineDetailModal-CEOZTzel.js";import{R as ut}from"./RequestDetailModal-DdFujB5o.js";import{u as it,a as rt,b as dt,c as ct,f as _t,d as O,g as j,e as mt,h as ft,i as pt}from"./useApi-Ci9ikep3.js";import{u as vt,_ as yt}from"./index-C3c8jOCC.js";import{f as xt,h as gt,S as bt,D as ht,i as qt,j as kt,k as Dt,T as P,B as U,a as $,I as wt,l as Ct,m as St,n as Rt,o as Gt,p as At}from"./ant-design-vue-DhOu_vW1.js";import{d as It,f as g,c as f,o as Tt,b as Bt,Y as C,X as n,k as e,W as s,u as a,H,S as Lt,V as b,l as h,U as Mt,$ as i,a3 as z,G as d,a4 as Vt}from"./vue-vendor-CHXvf8H0.js";import"./SessionLogsDisplay-Cp0w6Fp8.js";const Nt={class:"dashboard"},Ot={class:"mb-6"},jt={key:0,class:"empty-state"},Pt={class:"text-center py-8"},Ut={class:"text-sm text-gray-500"},$t={class:"flex items-center justify-between"},Ht={class:"flex items-center gap-2 flex-1 basis-0 min-w-0 overflow-hidden"},zt={class:"block font-medium font-mono text-sm truncate w-0 flex-1 basis-0 min-w-0 max-w-[80%]"},Wt={class:"flex items-center justify-between"},Et={class:"flex items-center gap-2 flex-1 basis-0 min-w-0 overflow-hidden"},Xt={class:"block font-medium truncate w-0 flex-1 basis-0 min-w-0 max-w-[80%]"},Yt={key:0},Ft=It({__name:"Dashboard",setup(Jt){const r=vt(),{data:S,execute:R}=it(),{data:c,execute:G}=rt({limit:5}),{data:q,execute:A}=dt({limit:5}),{data:W,execute:E}=ct(),k=g(void 0),p=g(!1),D=g(),v=g(!1),X=f(()=>r.systemStats?.goroutine_stats?.active_count||c.value?.total||S.value?.goroutines?.total||0),Y=f(()=>r.systemStats?.request_stats?.total_requests||q.value?.total||0),F=f(()=>W.value?.total_inuse_objects||0),J=f(()=>r.systemStats?.system_stats?.memory_usage||S.value?.memory?.heap_alloc||0),I=f(()=>r.recentGoroutines.length>0?r.recentGoroutines.slice(0,5):c.value?.data&&Array.isArray(c.value.data)?c.value.data.slice(0,5).map(t=>({id:t.id,name:t.name,status:t.status,duration:t.end_time?t.end_time-t.start_time:Math.floor(Date.now()/1e3)-t.start_time,start_time:t.start_time,stack_trace:t.stack,function_name:t.name})):[]),K=f(()=>r.recentRequests.length>0?r.recentRequests.slice(0,5):q.value?.data?q.value.data.slice(0,5).map(t=>({request_id:t.request_id,req_method:t.req_method,req_url:t.req_url,resp_status_code:Number.parseInt(t.resp_status_code)||0,status:t.status||"completed",ip:t.ip,latency:t.latency,start_time:t.start_time||Math.floor(Date.now()/1e3),end_time:t.end_time})):[]);function Q(t){if(t.stack_trace){const l=t.stack_trace.split(`
`).filter(u=>u.trim());for(let u=1;u<l.length&&u<3;u+=2){const y=l[u]?.trim();if(y&&!y.includes("goroutine "))return y}}return t.name&&t.name!==`goroutine-${t.id.replace(/^runtime-/,"")}`?t.name:`Goroutine #${t.id.replace(/^runtime-/,"")}`}function Z(t){return ft(t.duration*1e3)}Tt(async()=>{await Promise.all([R(),G(),A(),E()])});const tt=setInterval(async()=>{r.isConnected||await Promise.all([R(),G(),A()])},3e4);Bt(()=>{clearInterval(tt)});async function et(t){const{data:l,execute:u}=pt(t.request_id);await u(),k.value=l.value||t,p.value=!0}function st(){p.value=!1,k.value=void 0}function at(t){D.value=t,v.value=!0}function lt(){v.value=!1,D.value=void 0}return(t,l)=>{const u=bt,y=xt,x=Dt,_=kt,m=qt,T=gt,B=Lt("RouterLink"),w=Gt,L=At,M=Rt,V=St,N=Ct;return b(),C("div",Nt,[n("div",Ot,[e(y,{level:2,class:"mb-4"},{default:s(()=>[e(u,null,{default:s(()=>[e(a(ht)),l[2]||(l[2]=n("span",null,"仪表盘",-1))]),_:1})]),_:1})]),e(T,{gutter:[24,24],class:"mb-8"},{default:s(()=>[e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(_,null,{default:s(()=>[e(x,{title:"活跃协程",value:a(X),prefix:("h"in t?t.h:a(h))(a(P),{style:{color:"#1890ff"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(_,null,{default:s(()=>[e(x,{title:"总请求数",value:a(Y),prefix:("h"in t?t.h:a(h))(a(U),{style:{color:"#52c41a"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(_,null,{default:s(()=>[e(x,{title:"Heap",value:a(F),prefix:("h"in t?t.h:a(h))(a($),{style:{color:"#faad14"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(_,null,{default:s(()=>[e(x,{title:"内存使用",value:a(_t)(a(J)),prefix:("h"in t?t.h:a(h))(a($),{style:{color:"#f5222d"}})},null,8,["value","prefix"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:[24,24]},{default:s(()=>[e(m,{xs:24,lg:12},{default:s(()=>[e(_,null,{title:s(()=>[e(u,null,{default:s(()=>[e(a(P)),l[3]||(l[3]=n("span",null,"最近协程活动",-1))]),_:1})]),extra:s(()=>[e(B,{to:"/goroutines",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...l[4]||(l[4]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[a(I).length===0&&(a(c)?.total??0)>0?(b(),C("div",jt,[n("div",Pt,[e(a(wt),{class:"text-4xl text-gray-400 mb-4"}),l[5]||(l[5]=n("p",{class:"text-gray-600 mb-2"}," 协程跟踪未启用 ",-1)),n("p",Ut," 系统当前有 "+i(a(c)?.total??0)+" 个协程运行，但未启用跟踪功能 ",1)])])):(b(),Mt(N,{key:1,"data-source":a(I),locale:{emptyText:"暂无协程数据"}},{renderItem:s(({item:o})=>[e(V,null,{default:s(()=>[e(M,null,{title:s(()=>[n("div",$t,[n("div",Ht,[e(w,{class:z(a(j)(o.status))},{default:s(()=>[d(i(o.status),1)]),_:2},1032,["class"]),n("span",zt,i(Q(o)),1)]),e(L,{type:"link",size:"small",onClick:ot=>at(o)},{default:s(()=>[...l[6]||(l[6]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(u,null,{default:s(()=>[n("span",null,"运行时长: "+i(Z(o)),1),n("span",null,"开始时间: "+i(a(O)(o.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"]))]),_:1})]),_:1}),e(m,{xs:24,lg:12},{default:s(()=>[e(_,null,{title:s(()=>[e(u,null,{default:s(()=>[e(a(U)),l[7]||(l[7]=n("span",null,"最近请求记录",-1))]),_:1})]),extra:s(()=>[e(B,{to:"/requests",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...l[8]||(l[8]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[e(N,{"data-source":a(K),locale:{emptyText:"暂无请求数据"}},{renderItem:s(({item:o})=>[e(V,null,{default:s(()=>[e(M,null,{title:s(()=>[n("div",Wt,[n("div",Et,[e(w,{class:z(a(j)(o.resp_status_code))},{default:s(()=>[d(i(o.resp_status_code||o.status),1)]),_:2},1032,["class"]),e(w,{color:"blue"},{default:s(()=>[d(i(o.req_method),1)]),_:2},1024),n("span",Xt,i(o.req_url),1)]),e(L,{type:"link",size:"small",onClick:ot=>et(o)},{default:s(()=>[...l[9]||(l[9]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(u,null,{default:s(()=>[n("span",null,"IP: "+i(o.ip),1),o.latency?(b(),C("span",Yt,"延迟: "+i(a(mt)(o.latency)),1)):Vt("",!0),n("span",null,"时间: "+i(a(O)(o.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1}),e(ut,{visible:a(p),"onUpdate:visible":l[0]||(l[0]=o=>H(p)?p.value=o:null),request:a(k),onClose:st},null,8,["visible","request"]),e(nt,{visible:a(v),"onUpdate:visible":l[1]||(l[1]=o=>H(v)?v.value=o:null),goroutine:a(D),onClose:lt},null,8,["visible","goroutine"])])}}}),le=yt(Ft,[["__scopeId","data-v-306ad366"]]);export{le as default};

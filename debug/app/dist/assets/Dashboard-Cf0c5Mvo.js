import{G as it}from"./GoroutineDetailModal-gNY8ZOQw.js";import{R as dt}from"./RequestDetailModal-WuXQgFmw.js";import{u as _t,a as ct,b as mt,c as ft,f as pt,d as O,g as j,e as vt,h as yt,i as gt}from"./useApi-C9wvGAhc.js";import{u as xt,_ as bt}from"./index-BG6BHNhw.js";import{f as ht,h as qt,S as kt,D as Dt,i as Ct,j as St,k as Gt,T as P,B as U,a as H,I as Rt,l as At,m as It,n as wt,o as Tt,p as Bt,q as Lt}from"./ant-design-vue-BZxoqjSI.js";import{d as Mt,f as b,c as f,o as Vt,b as $t,Y as h,X as u,k as e,W as s,u as a,H as z,S as Nt,V as p,l as q,U as W,$ as r,a3 as E,G as d,a4 as Ot}from"./vue-vendor-PlmX_NZX.js";import"./SessionLogsDisplay-nu0O8H-k.js";const jt={class:"dashboard"},Pt={class:"mb-6"},Ut={key:0,class:"empty-state"},Ht={class:"text-center py-8"},zt={class:"text-sm text-gray-500"},Wt={class:"flex items-center justify-between"},Et={class:"font-medium font-mono text-sm"},Xt={key:1,class:"font-medium text-gray-500"},Yt={class:"flex items-center justify-between"},Ft={class:"font-medium truncate"},Jt={key:0},Kt=Mt({__name:"Dashboard",setup(Qt){const i=xt(),{data:G,execute:R}=_t(),{data:_,execute:A}=ct({limit:5}),{data:k,execute:I}=mt({limit:5}),{data:X,execute:Y}=ft(),D=b(void 0),v=b(!1),C=b(),y=b(!1),F=f(()=>i.systemStats?.goroutine_stats?.active_count||_.value?.total||G.value?.goroutines?.total||0),J=f(()=>i.systemStats?.request_stats?.total_requests||k.value?.total||0),K=f(()=>X.value?.total_inuse_objects||0),Q=f(()=>i.systemStats?.system_stats?.memory_usage||G.value?.memory?.heap_alloc||0),w=f(()=>i.recentGoroutines.length>0?i.recentGoroutines.slice(0,5):_.value?.data&&Array.isArray(_.value.data)?_.value.data.slice(0,5).map(t=>({id:t.id,name:t.name,status:t.status,duration:t.end_time?t.end_time-t.start_time:Math.floor(Date.now()/1e3)-t.start_time,start_time:t.start_time,stack_trace:t.stack,function_name:t.name})):[]),Z=f(()=>i.recentRequests.length>0?i.recentRequests.slice(0,5):k.value?.data?k.value.data.slice(0,5).map(t=>({request_id:t.request_id,req_method:t.req_method,req_url:t.req_url,resp_status_code:Number.parseInt(t.resp_status_code)||0,status:t.status||"completed",ip:t.ip,latency:t.latency,start_time:t.start_time||Math.floor(Date.now()/1e3),end_time:t.end_time})):[]);function T(t){if(t.stack_trace){const o=t.stack_trace.split(`
`).filter(l=>l.trim());for(let l=1;l<o.length&&l<3;l+=2){const g=o[l]?.trim();if(g&&!g.includes("goroutine "))return g}}return t.name&&t.name!==`goroutine-${t.id.replace(/^runtime-/,"")}`?t.name:`Goroutine #${t.id.replace(/^runtime-/,"")}`}function tt(t){return t.id.replace(/^runtime-/,"")}function et(t){return yt(t.duration*1e3)}Vt(async()=>{await Promise.all([R(),A(),I(),Y()])});const st=setInterval(async()=>{i.isConnected||await Promise.all([R(),A(),I()])},3e4);$t(()=>{clearInterval(st)});async function at(t){const{data:o,execute:l}=gt(t.request_id);await l(),D.value=o.value||t,v.value=!0}function nt(){v.value=!1,D.value=void 0}function ot(t){C.value=t,y.value=!0}function lt(){y.value=!1,C.value=void 0}return(t,o)=>{const l=kt,g=ht,x=Gt,c=St,m=Ct,B=qt,L=Nt("RouterLink"),S=Tt,ut=Bt,M=Lt,V=wt,$=It,N=At;return p(),h("div",jt,[u("div",Pt,[e(g,{level:2,class:"mb-4"},{default:s(()=>[e(l,null,{default:s(()=>[e(a(Dt)),o[2]||(o[2]=u("span",null,"仪表盘",-1))]),_:1})]),_:1})]),e(B,{gutter:[24,24],class:"mb-8"},{default:s(()=>[e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(x,{title:"活跃协程",value:a(F),prefix:("h"in t?t.h:a(q))(a(P),{style:{color:"#1890ff"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(x,{title:"总请求数",value:a(J),prefix:("h"in t?t.h:a(q))(a(U),{style:{color:"#52c41a"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(x,{title:"Heap",value:a(K),prefix:("h"in t?t.h:a(q))(a(H),{style:{color:"#faad14"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(x,{title:"内存使用",value:a(pt)(a(Q)),prefix:("h"in t?t.h:a(q))(a(H),{style:{color:"#f5222d"}})},null,8,["value","prefix"])]),_:1})]),_:1})]),_:1}),e(B,{gutter:[24,24]},{default:s(()=>[e(m,{xs:24,lg:12},{default:s(()=>[e(c,null,{title:s(()=>[e(l,null,{default:s(()=>[e(a(P)),o[3]||(o[3]=u("span",null,"最近协程活动",-1))]),_:1})]),extra:s(()=>[e(L,{to:"/goroutines",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...o[4]||(o[4]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[a(w).length===0&&(a(_)?.total??0)>0?(p(),h("div",Ut,[u("div",Ht,[e(a(Rt),{class:"text-4xl text-gray-400 mb-4"}),o[5]||(o[5]=u("p",{class:"text-gray-600 mb-2"}," 协程跟踪未启用 ",-1)),u("p",zt," 系统当前有 "+r(a(_)?.total??0)+" 个协程运行，但未启用跟踪功能 ",1)])])):(p(),W(N,{key:1,"data-source":a(w),locale:{emptyText:"暂无协程数据"}},{renderItem:s(({item:n})=>[e($,null,{default:s(()=>[e(V,null,{title:s(()=>[u("div",Wt,[e(l,null,{default:s(()=>[e(S,{class:E(a(j)(n.status))},{default:s(()=>[d(r(n.status),1)]),_:2},1032,["class"]),n.name&&n.name!==`goroutine-${tt(n)}`?(p(),W(ut,{key:0,title:n.name},{default:s(()=>[u("span",Et,r(T(n)),1)]),_:2},1032,["title"])):(p(),h("span",Xt,r(T(n)),1))]),_:2},1024),e(M,{type:"link",size:"small",onClick:rt=>ot(n)},{default:s(()=>[...o[6]||(o[6]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(l,null,{default:s(()=>[u("span",null,"运行时长: "+r(et(n)),1),u("span",null,"开始时间: "+r(a(O)(n.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"]))]),_:1})]),_:1}),e(m,{xs:24,lg:12},{default:s(()=>[e(c,null,{title:s(()=>[e(l,null,{default:s(()=>[e(a(U)),o[7]||(o[7]=u("span",null,"最近请求记录",-1))]),_:1})]),extra:s(()=>[e(L,{to:"/requests",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...o[8]||(o[8]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[e(N,{"data-source":a(Z),locale:{emptyText:"暂无请求数据"}},{renderItem:s(({item:n})=>[e($,null,{default:s(()=>[e(V,null,{title:s(()=>[u("div",Yt,[e(l,null,{default:s(()=>[e(S,{class:E(a(j)(n.resp_status_code))},{default:s(()=>[d(r(n.resp_status_code||n.status),1)]),_:2},1032,["class"]),e(S,{color:"blue"},{default:s(()=>[d(r(n.req_method),1)]),_:2},1024),u("span",Ft,r(n.req_url),1)]),_:2},1024),e(M,{type:"link",size:"small",onClick:rt=>at(n)},{default:s(()=>[...o[9]||(o[9]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(l,null,{default:s(()=>[u("span",null,"IP: "+r(n.ip),1),n.latency?(p(),h("span",Jt,"延迟: "+r(a(vt)(n.latency)),1)):Ot("",!0),u("span",null,"时间: "+r(a(O)(n.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1}),e(dt,{visible:a(v),"onUpdate:visible":o[0]||(o[0]=n=>z(v)?v.value=n:null),request:a(D),onClose:nt},null,8,["visible","request"]),e(it,{visible:a(y),"onUpdate:visible":o[1]||(o[1]=n=>z(y)?y.value=n:null),goroutine:a(C),onClose:lt},null,8,["visible","goroutine"])])}}}),le=bt(Kt,[["__scopeId","data-v-542b81e1"]]);export{le as default};

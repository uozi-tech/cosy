import{G as nt}from"./GoroutineDetailModal-DP7SMWY7.js";import{R as ut}from"./RequestDetailModal-CgxbvD4m.js";import{u as rt,a as it,b as dt,c as _t,f as ct,d as O,g as j,e as mt,h as ft,i as pt}from"./useApi-IzsPK38c.js";import{u as vt,_ as yt}from"./index-DqyMwlFd.js";import{f as gt,h as xt,S as bt,D as ht,i as qt,j as Dt,k as kt,T as P,B as U,a as $,I as Ct,l as St,m as Rt,n as Gt,o as At,p as wt}from"./ant-design-vue-B0-qvlsP.js";import{d as It,f as x,c as f,o as Tt,b as Bt,Y as S,X as u,k as e,W as s,u as a,H,S as Lt,V as b,l as h,U as Mt,$ as r,a3 as z,G as d,a4 as Vt}from"./vue-vendor-gqGt9jxi.js";import"./SessionLogsDisplay-DEMAKb0C.js";const Nt={class:"dashboard"},Ot={class:"mb-6"},jt={key:0,class:"empty-state"},Pt={class:"text-center py-8"},Ut={class:"text-sm text-gray-500"},$t={class:"flex items-center justify-between"},Ht={class:"font-medium font-mono text-sm"},zt={class:"flex items-center justify-between"},Wt={class:"font-medium truncate"},Et={key:0},Xt=It({__name:"Dashboard",setup(Yt){const i=vt(),{data:R,execute:G}=rt(),{data:_,execute:A}=it({limit:5}),{data:q,execute:w}=dt({limit:5}),{data:W,execute:E}=_t(),D=x(void 0),p=x(!1),k=x(),v=x(!1),X=f(()=>i.systemStats?.goroutine_stats?.active_count||_.value?.total||R.value?.goroutines?.total||0),Y=f(()=>i.systemStats?.request_stats?.total_requests||q.value?.total||0),F=f(()=>W.value?.total_inuse_objects||0),J=f(()=>i.systemStats?.system_stats?.memory_usage||R.value?.memory?.heap_alloc||0),I=f(()=>i.recentGoroutines.length>0?i.recentGoroutines.slice(0,5):_.value?.data&&Array.isArray(_.value.data)?_.value.data.slice(0,5).map(t=>({id:t.id,name:t.name,status:t.status,duration:t.end_time?t.end_time-t.start_time:Math.floor(Date.now()/1e3)-t.start_time,start_time:t.start_time,stack_trace:t.stack,function_name:t.name})):[]),K=f(()=>i.recentRequests.length>0?i.recentRequests.slice(0,5):q.value?.data?q.value.data.slice(0,5).map(t=>({request_id:t.request_id,req_method:t.req_method,req_url:t.req_url,resp_status_code:Number.parseInt(t.resp_status_code)||0,status:t.status||"completed",ip:t.ip,latency:t.latency,start_time:t.start_time||Math.floor(Date.now()/1e3),end_time:t.end_time})):[]);function Q(t){if(t.stack_trace){const l=t.stack_trace.split(`
`).filter(n=>n.trim());for(let n=1;n<l.length&&n<3;n+=2){const y=l[n]?.trim();if(y&&!y.includes("goroutine "))return y}}return t.name&&t.name!==`goroutine-${t.id.replace(/^runtime-/,"")}`?t.name:`Goroutine #${t.id.replace(/^runtime-/,"")}`}function Z(t){return ft(t.duration*1e3)}Tt(async()=>{await Promise.all([G(),A(),w(),E()])});const tt=setInterval(async()=>{i.isConnected||await Promise.all([G(),A(),w()])},3e4);Bt(()=>{clearInterval(tt)});async function et(t){const{data:l,execute:n}=pt(t.request_id);await n(),D.value=l.value||t,p.value=!0}function st(){p.value=!1,D.value=void 0}function at(t){k.value=t,v.value=!0}function lt(){v.value=!1,k.value=void 0}return(t,l)=>{const n=bt,y=gt,g=kt,c=Dt,m=qt,T=xt,B=Lt("RouterLink"),C=At,L=wt,M=Gt,V=Rt,N=St;return b(),S("div",Nt,[u("div",Ot,[e(y,{level:2,class:"mb-4"},{default:s(()=>[e(n,null,{default:s(()=>[e(a(ht)),l[2]||(l[2]=u("span",null,"仪表盘",-1))]),_:1})]),_:1})]),e(T,{gutter:[24,24],class:"mb-8"},{default:s(()=>[e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(g,{title:"活跃协程",value:a(X),prefix:("h"in t?t.h:a(h))(a(P),{style:{color:"#1890ff"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(g,{title:"总请求数",value:a(Y),prefix:("h"in t?t.h:a(h))(a(U),{style:{color:"#52c41a"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(g,{title:"Heap",value:a(F),prefix:("h"in t?t.h:a(h))(a($),{style:{color:"#faad14"}})},null,8,["value","prefix"])]),_:1})]),_:1}),e(m,{xs:24,sm:12,lg:6},{default:s(()=>[e(c,null,{default:s(()=>[e(g,{title:"内存使用",value:a(ct)(a(J)),prefix:("h"in t?t.h:a(h))(a($),{style:{color:"#f5222d"}})},null,8,["value","prefix"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:[24,24]},{default:s(()=>[e(m,{xs:24,lg:12},{default:s(()=>[e(c,null,{title:s(()=>[e(n,null,{default:s(()=>[e(a(P)),l[3]||(l[3]=u("span",null,"最近协程活动",-1))]),_:1})]),extra:s(()=>[e(B,{to:"/goroutines",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...l[4]||(l[4]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[a(I).length===0&&(a(_)?.total??0)>0?(b(),S("div",jt,[u("div",Pt,[e(a(Ct),{class:"text-4xl text-gray-400 mb-4"}),l[5]||(l[5]=u("p",{class:"text-gray-600 mb-2"}," 协程跟踪未启用 ",-1)),u("p",Ut," 系统当前有 "+r(a(_)?.total??0)+" 个协程运行，但未启用跟踪功能 ",1)])])):(b(),Mt(N,{key:1,"data-source":a(I),locale:{emptyText:"暂无协程数据"}},{renderItem:s(({item:o})=>[e(V,null,{default:s(()=>[e(M,null,{title:s(()=>[u("div",$t,[e(n,null,{default:s(()=>[e(C,{class:z(a(j)(o.status))},{default:s(()=>[d(r(o.status),1)]),_:2},1032,["class"]),u("span",Ht,r(Q(o)),1)]),_:2},1024),e(L,{type:"link",size:"small",onClick:ot=>at(o)},{default:s(()=>[...l[6]||(l[6]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(n,null,{default:s(()=>[u("span",null,"运行时长: "+r(Z(o)),1),u("span",null,"开始时间: "+r(a(O)(o.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"]))]),_:1})]),_:1}),e(m,{xs:24,lg:12},{default:s(()=>[e(c,null,{title:s(()=>[e(n,null,{default:s(()=>[e(a(U)),l[7]||(l[7]=u("span",null,"最近请求记录",-1))]),_:1})]),extra:s(()=>[e(B,{to:"/requests",class:"text-primary-500 hover:text-primary-600"},{default:s(()=>[...l[8]||(l[8]=[d(" 查看全部 → ",-1)])]),_:1})]),default:s(()=>[e(N,{"data-source":a(K),locale:{emptyText:"暂无请求数据"}},{renderItem:s(({item:o})=>[e(V,null,{default:s(()=>[e(M,null,{title:s(()=>[u("div",zt,[e(n,null,{default:s(()=>[e(C,{class:z(a(j)(o.resp_status_code))},{default:s(()=>[d(r(o.resp_status_code||o.status),1)]),_:2},1032,["class"]),e(C,{color:"blue"},{default:s(()=>[d(r(o.req_method),1)]),_:2},1024),u("span",Wt,r(o.req_url),1)]),_:2},1024),e(L,{type:"link",size:"small",onClick:ot=>et(o)},{default:s(()=>[...l[9]||(l[9]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])])]),description:s(()=>[e(n,null,{default:s(()=>[u("span",null,"IP: "+r(o.ip),1),o.latency?(b(),S("span",Et,"延迟: "+r(a(mt)(o.latency)),1)):Vt("",!0),u("span",null,"时间: "+r(a(O)(o.start_time)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1}),e(ut,{visible:a(p),"onUpdate:visible":l[0]||(l[0]=o=>H(p)?p.value=o:null),request:a(D),onClose:st},null,8,["visible","request"]),e(nt,{visible:a(v),"onUpdate:visible":l[1]||(l[1]=o=>H(v)?v.value=o:null),goroutine:a(k),onClose:lt},null,8,["visible","goroutine"])])}}}),se=yt(Xt,[["__scopeId","data-v-4ba269f8"]]);export{se as default};

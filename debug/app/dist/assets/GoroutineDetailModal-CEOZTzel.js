import{g as S,h as w,k as g}from"./useApi-Ci9ikep3.js";import{S as G}from"./SessionLogsDisplay-Cp0w6Fp8.js";import{v as I,w as B,o as M,x as N,j as A}from"./ant-design-vue-DhOu_vW1.js";import{d as T,c as v,U as l,W as a,V as r,Y as V,a4 as i,u as e,k as u,G as _,$ as n,a3 as q,X as p}from"./vue-vendor-CHXvf8H0.js";import{_ as L}from"./index-C3c8jOCC.js";const $={key:0,class:"space-y-4"},F={class:"font-medium"},U={class:"font-mono text-sm"},j={class:"bg-gray-50 p-4 rounded text-xs overflow-auto max-h-60 font-mono"},E={class:"bg-red-50 p-4 rounded text-xs overflow-auto max-h-40 text-red-700"},J=T({__name:"GoroutineDetailModal",props:{visible:{type:Boolean},goroutine:{}},emits:["update:visible","close"],setup(k,{emit:x}){const b=k,y=x;function D(s){const m=s.stack||s.stack_trace;if(m){const o=m.split(`
`).filter(c=>c.trim());for(let c=1;c<o.length&&c<3;c+=2){const d=o[c]?.trim();if(d&&!d.includes("goroutine "))return d}}return s.name&&s.name!==`goroutine-${s.id.replace(/^runtime-/,"")}`?s.name:`Goroutine #${s.id.replace(/^runtime-/,"")}`}const t=v(()=>{if(!b.goroutine)return;const s=b.goroutine;return{id:s.id,name:D(s),status:s.status,start_time:s.start_time,end_time:s.end_time,stack:s.stack||s.stack_trace,error:s.error,session_logs:s.session_logs,duration:(()=>{const m=Math.floor(Date.now()/1e3);return(s.end_time?s.end_time-s.start_time:m-s.start_time)*1e3})(),request_id:s.request_id,last_heartbeat:s.last_heartbeat,cpu_usage:s.cpu_usage,memory_usage:s.memory_usage}}),h=v(()=>!t.value?.session_logs||t.value.session_logs.length===0?null:JSON.stringify(t.value.session_logs));function C(){y("update:visible",!1),y("close")}return(s,m)=>{const o=B,c=M,d=N,f=A,z=I;return r(),l(z,{open:k.visible,title:"协程详细信息",footer:null,width:"900px",onCancel:C},{default:a(()=>[e(t)?(r(),V("div",$,[u(d,{title:"基本信息",column:2,size:"small",bordered:""},{default:a(()=>[u(o,{label:"协程ID"},{default:a(()=>[_(n(e(t).id),1)]),_:1}),u(o,{label:"状态"},{default:a(()=>[u(c,{class:q(e(S)(e(t).status))},{default:a(()=>[_(n(e(t).status),1)]),_:1},8,["class"])]),_:1}),u(o,{label:"名称"},{default:a(()=>[p("span",F,n(e(t).name),1)]),_:1}),u(o,{label:"运行时长"},{default:a(()=>[_(n(e(w)(e(t).duration)),1)]),_:1}),u(o,{label:"开始时间"},{default:a(()=>[_(n(e(g)(e(t).start_time)),1)]),_:1}),e(t).end_time?(r(),l(o,{key:0,label:"结束时间"},{default:a(()=>[_(n(e(g)(e(t).end_time)),1)]),_:1})):i("",!0),e(t).request_id?(r(),l(o,{key:1,label:"关联请求ID"},{default:a(()=>[p("span",U,n(e(t).request_id),1)]),_:1})):i("",!0),e(t).last_heartbeat?(r(),l(o,{key:2,label:"最后心跳"},{default:a(()=>[_(n(e(g)(e(t).last_heartbeat)),1)]),_:1})):i("",!0)]),_:1}),e(t).cpu_usage!==void 0||e(t).memory_usage!==void 0?(r(),l(f,{key:0,size:"small",title:"性能指标"},{default:a(()=>[u(d,{column:2,size:"small"},{default:a(()=>[e(t).cpu_usage!==void 0?(r(),l(o,{key:0,label:"CPU使用率"},{default:a(()=>[_(n(e(t).cpu_usage.toFixed(2))+"% ",1)]),_:1})):i("",!0),e(t).memory_usage!==void 0?(r(),l(o,{key:1,label:"内存使用"},{default:a(()=>[_(n((e(t).memory_usage/1024/1024).toFixed(2))+" MB ",1)]),_:1})):i("",!0)]),_:1})]),_:1})):i("",!0),e(h)?(r(),l(f,{key:1,size:"small"},{default:a(()=>[u(G,{"session-logs":e(h)},null,8,["session-logs"])]),_:1})):i("",!0),e(t).stack?(r(),l(f,{key:2,size:"small",title:"堆栈跟踪"},{default:a(()=>[p("pre",j,n(e(t).stack),1)]),_:1})):i("",!0),e(t).error?(r(),l(f,{key:3,size:"small",title:"错误信息"},{default:a(()=>[p("pre",E,n(e(t).error),1)]),_:1})):i("",!0)])):i("",!0)]),_:1},8,["open"])}}}),H=L(J,[["__scopeId","data-v-c6e0e607"]]);export{H as G};

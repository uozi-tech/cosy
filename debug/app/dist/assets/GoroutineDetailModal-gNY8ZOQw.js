import{g as S,h as w,k as g}from"./useApi-C9wvGAhc.js";import{S as G}from"./SessionLogsDisplay-nu0O8H-k.js";import{w as I,x as B,o as M,y as N,j as A}from"./ant-design-vue-BZxoqjSI.js";import{d as T,c as h,U as l,W as a,V as r,Y as V,a4 as i,u as e,k as u,G as _,$ as n,a3 as q,X as p}from"./vue-vendor-PlmX_NZX.js";import{_ as L}from"./index-BG6BHNhw.js";const $={key:0,class:"space-y-4"},F={class:"font-medium"},U={class:"font-mono text-sm"},j={class:"bg-gray-50 p-4 rounded text-xs overflow-auto max-h-60 font-mono"},E={class:"bg-red-50 p-4 rounded text-xs overflow-auto max-h-40 text-red-700"},J=T({__name:"GoroutineDetailModal",props:{visible:{type:Boolean},goroutine:{}},emits:["update:visible","close"],setup(v,{emit:x}){const k=v,y=x;function D(t){const m=t.stack||t.stack_trace;if(m){const o=m.split(`
`).filter(c=>c.trim());for(let c=1;c<o.length&&c<3;c+=2){const d=o[c]?.trim();if(d&&!d.includes("goroutine "))return d}}return t.name&&t.name!==`goroutine-${t.id.replace(/^runtime-/,"")}`?t.name:`Goroutine #${t.id.replace(/^runtime-/,"")}`}const s=h(()=>{if(!k.goroutine)return;const t=k.goroutine;return{id:t.id,name:D(t),status:t.status,start_time:t.start_time,end_time:t.end_time,stack:t.stack||t.stack_trace,error:t.error,session_logs:t.session_logs,duration:(()=>{const m=Math.floor(Date.now()/1e3);return(t.end_time?t.end_time-t.start_time:m-t.start_time)*1e3})(),request_id:t.request_id,last_heartbeat:t.last_heartbeat,cpu_usage:t.cpu_usage,memory_usage:t.memory_usage}}),b=h(()=>!s.value?.session_logs||s.value.session_logs.length===0?null:JSON.stringify(s.value.session_logs));function C(){y("update:visible",!1),y("close")}return(t,m)=>{const o=B,c=M,d=N,f=A,z=I;return r(),l(z,{open:t.visible,title:"协程详细信息",footer:null,width:"900px",onCancel:C},{default:a(()=>[e(s)?(r(),V("div",$,[u(d,{title:"基本信息",column:2,size:"small",bordered:""},{default:a(()=>[u(o,{label:"协程ID"},{default:a(()=>[_(n(e(s).id),1)]),_:1}),u(o,{label:"状态"},{default:a(()=>[u(c,{class:q(e(S)(e(s).status))},{default:a(()=>[_(n(e(s).status),1)]),_:1},8,["class"])]),_:1}),u(o,{label:"名称"},{default:a(()=>[p("span",F,n(e(s).name),1)]),_:1}),u(o,{label:"运行时长"},{default:a(()=>[_(n(e(w)(e(s).duration)),1)]),_:1}),u(o,{label:"开始时间"},{default:a(()=>[_(n(e(g)(e(s).start_time)),1)]),_:1}),e(s).end_time?(r(),l(o,{key:0,label:"结束时间"},{default:a(()=>[_(n(e(g)(e(s).end_time)),1)]),_:1})):i("",!0),e(s).request_id?(r(),l(o,{key:1,label:"关联请求ID"},{default:a(()=>[p("span",U,n(e(s).request_id),1)]),_:1})):i("",!0),e(s).last_heartbeat?(r(),l(o,{key:2,label:"最后心跳"},{default:a(()=>[_(n(e(g)(e(s).last_heartbeat)),1)]),_:1})):i("",!0)]),_:1}),e(s).cpu_usage!==void 0||e(s).memory_usage!==void 0?(r(),l(f,{key:0,size:"small",title:"性能指标"},{default:a(()=>[u(d,{column:2,size:"small"},{default:a(()=>[e(s).cpu_usage!==void 0?(r(),l(o,{key:0,label:"CPU使用率"},{default:a(()=>[_(n(e(s).cpu_usage.toFixed(2))+"% ",1)]),_:1})):i("",!0),e(s).memory_usage!==void 0?(r(),l(o,{key:1,label:"内存使用"},{default:a(()=>[_(n((e(s).memory_usage/1024/1024).toFixed(2))+" MB ",1)]),_:1})):i("",!0)]),_:1})]),_:1})):i("",!0),e(b)?(r(),l(f,{key:1,size:"small"},{default:a(()=>[u(G,{"session-logs":e(b)},null,8,["session-logs"])]),_:1})):i("",!0),e(s).stack?(r(),l(f,{key:2,size:"small",title:"堆栈跟踪"},{default:a(()=>[p("pre",j,n(e(s).stack),1)]),_:1})):i("",!0),e(s).error?(r(),l(f,{key:3,size:"small",title:"错误信息"},{default:a(()=>[p("pre",E,n(e(s).error),1)]),_:1})):i("",!0)])):i("",!0)]),_:1},8,["open"])}}}),H=L(J,[["__scopeId","data-v-c6e0e607"]]);export{H as G};

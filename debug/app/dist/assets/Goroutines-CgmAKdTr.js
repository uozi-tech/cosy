import{_ as J}from"./ControlsWrapper.vue_vue_type_script_setup_true_lang-ClSTU2RZ.js";import{G as Q}from"./GoroutineDetailModal-DP7SMWY7.js";import{a as X,d as Y,g as Z,h as K,j as P}from"./useApi-IzsPK38c.js";import{u as tt,_ as et}from"./index-DqyMwlFd.js";import{f as at,j as st,S as nt,T as R,q as ot,r as lt,s as it,t as ut,p as rt,R as dt,u as mt,o as pt}from"./ant-design-vue-B0-qvlsP.js";import{d as ct,f as S,r as _t,c as ft,w as B,o as vt,b as gt,Y as d,X as _,k as a,W as s,u as i,H as C,V as u,G as p,a4 as k,U,$ as f,F as M,Z as yt,a3 as kt}from"./vue-vendor-gqGt9jxi.js";import"./SessionLogsDisplay-DEMAKb0C.js";const xt={class:"goroutines-page"},wt={class:"mb-6"},ht={key:0,class:"font-mono"},St={key:1,class:"space-y-1"},Ct={class:"font-medium text-sm text-black"},bt={key:0},Dt={key:1,class:"text-gray-500"},Tt={key:0,class:"text-xs text-gray-600 space-y-0.5"},It={class:"text-blue-600"},At={class:"text-gray-500"},Gt={key:0,class:"text-green-600 font-bold"},zt={key:1,class:"text-gray-400"},$t={class:"py-8 text-center"},Rt=ct({__name:"Goroutines",setup(Bt){const O=tt(),{data:A,loading:G,execute:z}=X(),v=S(""),x=S(),w=S(),T=S(),h=S(!1),c=_t({current:1,pageSize:50,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,pageSizeOptions:["50","100","200","500"],onChange:(e,t)=>{c.current=e,c.pageSize=t},onShowSizeChange:(e,t)=>{c.current=1,c.pageSize=t}}),V=[{title:"ID",dataIndex:"id",key:"id",width:100,ellipsis:!0,customRender:({record:e})=>e.id.replace(/^runtime-/,"")},{title:"名称/函数",dataIndex:"name",key:"name",ellipsis:!1,width:400,customRender:({record:e})=>e.name&&e.name!==`goroutine-${e.id.replace(/^runtime-/,"")}`?e.name:`Goroutine #${e.id.replace(/^runtime-/,"")}`},{title:"状态",dataIndex:"status",key:"status",width:120},{title:"日志",key:"logs",width:60,customRender:({record:e})=>e.session_logs&&e.session_logs.length>0?"✓":"-"},{title:"运行时长",dataIndex:"start_time",key:"duration",width:90,customRender:({record:e})=>{const t=Math.floor(Date.now()/1e3),n=e.end_time?e.end_time-e.start_time:t-e.start_time;return K(n*1e3)},sorter:(e,t)=>{const n=Math.floor(Date.now()/1e3),r=e.end_time?e.end_time-e.start_time:n-e.start_time,g=t.end_time?t.end_time-t.start_time:n-t.start_time;return r-g}},{title:"开始时间",dataIndex:"start_time",key:"start_time",width:120,customRender:({text:e})=>Y(e),sorter:(e,t)=>e.start_time-t.start_time},{title:"操作",key:"action",width:100}],L=ft(()=>(A.value?.data||[]).filter(t=>{const n=!v.value||t.name?.toLowerCase().includes(v.value.toLowerCase())||t.id.includes(v.value),r=!x.value||t.status===x.value;return n&&r}));B(A,e=>{c.total=e?.total||0},{immediate:!0});function $(e){if(!e)return[];const t=e.split(`
`).filter(r=>r.trim()),n=[];for(let r=1;r<t.length&&n.length<2;r+=2){const g=t[r]?.trim(),m=t[r+1]?.trim();if(g&&m){const b=g,y=m.match(/^(.+\.go):(\d+)\s+/);y&&n.push({file:y[1],line:y[2],func:b})}}return n}async function N(e){const{data:t,execute:n}=P(e.id);await n(),T.value=t.value||e,h.value=!0}function F(){h.value=!1,T.value=void 0}async function I(){await z({type:w.value})}vt(()=>{z()}),B(w,()=>{I()});const j=setInterval(()=>{O.isConnected||I()},3e4);return gt(()=>{clearInterval(j)}),(e,t)=>{const n=nt,r=at,g=ot,m=ut,b=it,y=rt,W=pt,q=mt,E=st;return u(),d("div",xt,[_("div",wt,[a(r,{level:2,class:"mb-4"},{default:s(()=>[a(n,null,{default:s(()=>[a(i(R)),t[5]||(t[5]=_("span",null,"协程监控",-1))]),_:1})]),_:1}),a(J,null,{default:s(()=>[a(g,{value:i(v),"onUpdate:value":t[0]||(t[0]=o=>C(v)?v.value=o:null),placeholder:"搜索协程名称或 ID",style:{width:"250px"},"allow-clear":""},{prefix:s(()=>[a(i(lt))]),_:1},8,["value"]),a(b,{value:i(x),"onUpdate:value":t[1]||(t[1]=o=>C(x)?x.value=o:null),placeholder:"筛选协程状态",style:{width:"150px"},"allow-clear":""},{default:s(()=>[a(m,{value:"running"},{default:s(()=>[...t[6]||(t[6]=[p(" 运行中 ",-1)])]),_:1}),a(m,{value:"waiting"},{default:s(()=>[...t[7]||(t[7]=[p(" 等待中 ",-1)])]),_:1}),a(m,{value:"completed"},{default:s(()=>[...t[8]||(t[8]=[p(" 已完成 ",-1)])]),_:1}),a(m,{value:"failed"},{default:s(()=>[...t[9]||(t[9]=[p(" 已失败 ",-1)])]),_:1}),a(m,{value:"blocked"},{default:s(()=>[...t[10]||(t[10]=[p(" 阻塞中 ",-1)])]),_:1})]),_:1},8,["value"]),a(b,{value:i(w),"onUpdate:value":t[2]||(t[2]=o=>C(w)?w.value=o:null),placeholder:"协程类型",style:{width:"120px"},"allow-clear":""},{default:s(()=>[a(m,{value:"active"},{default:s(()=>[...t[11]||(t[11]=[p(" 活跃协程 ",-1)])]),_:1}),a(m,{value:"history"},{default:s(()=>[...t[12]||(t[12]=[p(" 历史记录 ",-1)])]),_:1})]),_:1},8,["value"]),a(y,{type:"primary",loading:i(G),onClick:I},{icon:s(()=>[a(i(dt))]),default:s(()=>[t[13]||(t[13]=p(" 刷新数据 ",-1))]),_:1},8,["loading"])]),_:1})]),a(E,null,{default:s(()=>[a(q,{pagination:i(c),"onUpdate:pagination":t[3]||(t[3]=o=>C(c)?c.value=o:null),columns:V,"data-source":i(L),loading:i(G),scroll:{x:1200},"row-key":"id",size:"small"},{bodyCell:s(({column:o,record:l})=>[o.key==="id"?(u(),d("span",ht,f(l.id.replace(/^runtime-/,"")),1)):k("",!0),o.key==="name"?(u(),d("div",St,[_("div",Ct,[l.name&&l.name!==`goroutine-${l.id.replace(/^runtime-/,"")}`?(u(),d("span",bt,f(l.name),1)):(u(),d("span",Dt," Goroutine #"+f(l.id.replace(/^runtime-/,"")),1))]),l.stack&&$(l.stack).length>0?(u(),d("div",Tt,[(u(!0),d(M,null,yt($(l.stack),(D,H)=>(u(),d("div",{key:H,class:"font-mono"},[_("span",It,f(D.func),1),t[14]||(t[14]=_("br",null,null,-1)),_("span",At,f(D.file)+":"+f(D.line),1)]))),128))])):k("",!0)])):k("",!0),o.key==="status"?(u(),U(W,{key:2,class:kt(i(Z)(l.status))},{default:s(()=>[p(f(l.status),1)]),_:2},1032,["class"])):k("",!0),o.key==="logs"?(u(),d(M,{key:3},[l.session_logs&&l.session_logs.length>0?(u(),d("span",Gt," ✓ ")):(u(),d("span",zt," - "))],64)):k("",!0),o.key==="action"?(u(),U(n,{key:4},{default:s(()=>[a(y,{type:"link",size:"small",onClick:D=>N(l)},{default:s(()=>[...t[15]||(t[15]=[p(" 查看 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)):k("",!0)]),emptyText:s(()=>[_("div",$t,[a(i(R),{class:"text-4xl text-gray-300 mb-2"}),t[16]||(t[16]=_("p",{class:"text-gray-500"}," 暂无协程数据 ",-1))])]),_:1},8,["pagination","data-source","loading"])]),_:1}),a(Q,{visible:i(h),"onUpdate:visible":t[4]||(t[4]=o=>C(h)?h.value=o:null),goroutine:i(T),onClose:F},null,8,["visible","goroutine"])])}}}),jt=et(Rt,[["__scopeId","data-v-852a8923"]]);export{jt as default};

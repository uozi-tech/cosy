import{_ as st}from"./ControlsWrapper.vue_vue_type_script_setup_true_lang-ClSTU2RZ.js";import{f as A,c as nt}from"./useApi-B7vreXgg.js";import{v as ot,j as P,U as D,V as lt,S as W,o as at,f as it,a as N,q as ct,r as rt,W as dt,p as ut,R as _t,u as pt,P as mt}from"./ant-design-vue-B0-qvlsP.js";import{d as q,U as O,W as i,V as c,Y as u,a4 as g,k as a,X as s,$ as r,u as l,G as B,F as G,Z as J,f as R,r as yt,c as E,w as gt,o as ft,b as vt,H as V,l as xt}from"./vue-vendor-gqGt9jxi.js";import{_ as Q}from"./index-DXWGisRd.js";const _=[];for(let n=0;n<256;++n)_.push((n+256).toString(16).slice(1));function bt(n,o=0){return(_[n[o+0]]+_[n[o+1]]+_[n[o+2]]+_[n[o+3]]+"-"+_[n[o+4]]+_[n[o+5]]+"-"+_[n[o+6]]+_[n[o+7]]+"-"+_[n[o+8]]+_[n[o+9]]+"-"+_[n[o+10]]+_[n[o+11]]+_[n[o+12]]+_[n[o+13]]+_[n[o+14]]+_[n[o+15]]).toLowerCase()}let M;const ht=new Uint8Array(16);function kt(){if(!M){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");M=crypto.getRandomValues.bind(crypto)}return M(ht)}const wt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:wt};function St(n,o,b){n=n||{};const y=n.random??n.rng?.()??kt();if(y.length<16)throw new Error("Random bytes length must be >= 16");return y[6]=y[6]&15|64,y[8]=y[8]&63|128,bt(y)}function $t(n,o,b){return F.randomUUID&&!n?F.randomUUID():St(n)}const Ct={key:0,class:"space-y-4"},It={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ut={class:"text-center"},jt={class:"text-lg font-bold text-blue-600"},Tt={class:"text-center"},zt={class:"text-lg font-bold text-green-600"},At={class:"text-center"},Lt={class:"text-lg font-bold text-orange-600"},Rt={class:"text-center"},Vt={class:"text-lg font-bold text-red-600"},Bt={class:"flex items-center space-x-2"},Dt={key:0,class:"space-y-2"},Mt={class:"flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium"},Ot={class:"flex-1 min-w-0"},Ht={class:"space-y-1"},Nt={class:"font-mono text-sm font-semibold text-gray-900"},Et={key:0,class:"font-mono text-xs text-gray-600 pl-4 border-l-2 border-gray-300"},Ft={key:0,class:"text-xs text-blue-600 mt-2 font-medium"},Pt={key:1,class:"text-center py-8 text-gray-500"},Wt=q({__name:"StackTraceModal",props:{visible:{type:Boolean},entry:{}},emits:["update:visible","close"],setup(n,{emit:o}){const b=o;function y(){b("update:visible",!1),b("close")}return(p,d)=>{const f=P,k=lt,w=at,v=W,U=ot;return c(),O(U,{open:p.visible,title:"函数调用栈详情",footer:null,width:"900px",onCancel:y},{default:i(()=>[p.entry?(c(),u("div",Ct,[a(f,{size:"small",title:"分配统计"},{default:i(()=>[s("div",It,[s("div",Ut,[s("div",jt,r(p.entry.inuse_objects.toLocaleString()),1),d[0]||(d[0]=s("div",{class:"text-sm text-gray-600"}," 使用中对象 ",-1))]),s("div",Tt,[s("div",zt,r(l(A)(p.entry.inuse_bytes)),1),d[1]||(d[1]=s("div",{class:"text-sm text-gray-600"}," 使用中内存 ",-1))]),s("div",At,[s("div",Lt,r(p.entry.alloc_objects.toLocaleString()),1),d[2]||(d[2]=s("div",{class:"text-sm text-gray-600"}," 总分配对象 ",-1))]),s("div",Rt,[s("div",Vt,r(l(A)(p.entry.alloc_bytes)),1),d[3]||(d[3]=s("div",{class:"text-sm text-gray-600"}," 总分配内存 ",-1))])])]),_:1}),a(f,{size:"small",title:"主要函数"},{default:i(()=>[s("div",Bt,[a(l(D),{class:"text-blue-500"}),a(k,{code:"",class:"text-base"},{default:i(()=>[B(r(p.entry.top_function),1)]),_:1})])]),_:1}),a(f,{size:"small"},{title:i(()=>[a(v,null,{default:i(()=>[a(l(D)),d[4]||(d[4]=s("span",null,"完整调用栈",-1)),p.entry.stack_trace.length>0?(c(),O(w,{key:0,color:"blue"},{default:i(()=>[B(r(p.entry.stack_trace.length)+" 层 ",1)]),_:1})):g("",!0)]),_:1})]),default:i(()=>[p.entry.stack_trace.length>0?(c(),u("div",Dt,[(c(!0),u(G,null,J(p.entry.stack_trace,(j,S)=>(c(),u("div",{key:S,class:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[s("div",Mt,r(S+1),1),s("div",Ot,[s("div",Ht,[s("div",Nt,r(j.split(`
`)[0]),1),j.includes(`
`)?(c(),u("div",Et,r(j.split(`
`)[1]?.trim()),1)):g("",!0)]),S===0?(c(),u("div",Ft," ← 分配点 ")):g("",!0)])]))),128))])):(c(),u("div",Pt,[a(l(D),{class:"text-4xl mb-2"}),d[5]||(d[5]=s("p",null,"暂无调用栈信息",-1))]))]),_:1})])):g("",!0)]),_:1},8,["open"])}}}),qt=Q(Wt,[["__scopeId","data-v-c290c5f5"]]),Gt={class:"heap-page"},Jt={class:"mb-6"},Qt={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},Xt={class:"text-center"},Yt={class:"text-2xl font-bold text-blue-600"},Zt={class:"text-center"},Kt={class:"text-2xl font-bold text-green-600"},te={class:"text-center"},ee={class:"text-2xl font-bold text-orange-600"},se={class:"text-center"},ne={class:"text-2xl font-bold text-red-600"},oe={key:0,class:"text-sm text-gray-500"},le={key:0,class:"space-y-1"},ae={class:"font-medium text-sm text-black"},ie={key:0},ce={key:1},re={key:0,class:"text-xs text-gray-600 space-y-0.5"},de={class:"text-blue-600"},ue={key:0},_e={key:1,class:"text-gray-500"},pe={class:"py-8 text-center"},me=q({__name:"Heap",setup(n){const{data:o,loading:b,execute:y}=nt(),p=R(null),d=R(!1),f=R(""),k=R(void 0),w=R(void 0),v=yt({current:1,pageSize:50,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,pageSizeOptions:["50","100","200","500"],onChange:(e,t)=>{v.current=e,v.pageSize=t},onShowSizeChange:(e,t)=>{v.current=1,v.pageSize=t}});function U(e){if(!e||e.length===0)return[];const t=[];for(let $=0;$<Math.min(e.length,2);$++){const h=e[$];if(h)if(h.includes(`
`)){const x=h.split(`
`),L=x[0]?.trim(),T=x[1]?.trim();if(L&&T){const z=T.match(/^(.+\.go):(\d+)$/);z?t.push({file:z[1],line:z[2],func:L}):t.push({file:T,line:"",func:L})}}else t.push({file:"",line:"",func:h})}return t}const j=E(()=>(o.value?.entries||[]).map(t=>({...t,_uuid:$t()}))),S=E(()=>j.value?.filter(e=>{const t=!f.value||e.top_function?.toLowerCase().includes(f.value.toLowerCase())||e.stack_trace?.some(x=>x.toLowerCase().includes(f.value.toLowerCase())),$=k.value===void 0||e.inuse_bytes>=k.value,h=w.value===void 0||e.inuse_objects>=w.value;return t&&$&&h})||[]);gt(S,e=>{v.total=e?.length||0},{immediate:!0});const X=[{title:"函数",dataIndex:"top_function",key:"function",width:400,ellipsis:!1},{title:"使用中对象",dataIndex:"inuse_objects",key:"inuse_objects",width:120,align:"right",customRender:({text:e})=>e.toLocaleString(),sorter:(e,t)=>e.inuse_objects-t.inuse_objects},{title:"使用中内存",dataIndex:"inuse_bytes",key:"inuse_bytes",width:120,align:"right",customRender:({text:e})=>A(e),sorter:(e,t)=>e.inuse_bytes-t.inuse_bytes},{title:"总分配对象",dataIndex:"alloc_objects",key:"alloc_objects",width:120,align:"right",customRender:({text:e})=>e.toLocaleString(),sorter:(e,t)=>e.alloc_objects-t.alloc_objects},{title:"总分配内存",dataIndex:"alloc_bytes",key:"alloc_bytes",width:120,align:"right",customRender:({text:e})=>A(e),sorter:(e,t)=>e.alloc_bytes-t.alloc_bytes},{title:"内存占比",key:"memory_percentage",width:120,align:"center",customRender:({record:e})=>{if(!o.value)return"0%";const t=e.inuse_bytes/o.value.total_inuse_bytes*100;return xt(mt,{percent:Math.round(t*100)/100,size:"small",showInfo:!1,strokeColor:t>10?"#ff4d4f":t>5?"#faad14":"#52c41a"})}},{title:"操作",key:"action",width:80,align:"center"}];async function H(){await y()}ft(()=>{y()});const Y=setInterval(()=>{b.value||H()},3e4);vt(()=>{clearInterval(Y)});function Z(e){p.value=e,d.value=!0}function K(){d.value=!1,p.value=null}return(e,t)=>{const $=W,h=it,x=P,L=ct,T=dt,z=ut,tt=pt;return c(),u("div",Gt,[s("div",Jt,[a(h,{level:2,class:"mb-4"},{default:i(()=>[a($,null,{default:i(()=>[a(l(N)),t[5]||(t[5]=s("span",null,"堆内存分析",-1))]),_:1})]),_:1}),l(o)?(c(),u("div",Qt,[a(x,{size:"small"},{default:i(()=>[s("div",Xt,[s("div",Yt,r(l(o).total_inuse_objects.toLocaleString()),1),t[6]||(t[6]=s("div",{class:"text-sm text-gray-600"}," 使用中对象 ",-1))])]),_:1}),a(x,{size:"small"},{default:i(()=>[s("div",Zt,[s("div",Kt,r(l(A)(l(o).total_inuse_bytes)),1),t[7]||(t[7]=s("div",{class:"text-sm text-gray-600"}," 使用中内存 ",-1))])]),_:1}),a(x,{size:"small"},{default:i(()=>[s("div",te,[s("div",ee,r(l(o).total_alloc_objects.toLocaleString()),1),t[8]||(t[8]=s("div",{class:"text-sm text-gray-600"}," 总分配对象 ",-1))])]),_:1}),a(x,{size:"small"},{default:i(()=>[s("div",se,[s("div",ne,r(l(A)(l(o).total_alloc_bytes)),1),t[9]||(t[9]=s("div",{class:"text-sm text-gray-600"}," 总分配内存 ",-1))])]),_:1})])):g("",!0),a(st,null,{default:i(()=>[a(L,{value:l(f),"onUpdate:value":t[0]||(t[0]=m=>V(f)?f.value=m:null),placeholder:"搜索函数名或文件路径",style:{width:"280px"},"allow-clear":""},{prefix:i(()=>[a(l(rt))]),_:1},8,["value"]),a(T,{value:l(k),"onUpdate:value":t[1]||(t[1]=m=>V(k)?k.value=m:null),placeholder:"最小内存(字节)",style:{width:"180px"},min:0,"allow-clear":""},null,8,["value"]),a(T,{value:l(w),"onUpdate:value":t[2]||(t[2]=m=>V(w)?w.value=m:null),placeholder:"最小对象数",style:{width:"150px"},min:0,"allow-clear":""},null,8,["value"]),a(z,{type:"primary",loading:l(b),onClick:H},{icon:i(()=>[a(l(_t))]),default:i(()=>[t[10]||(t[10]=B(" 刷新数据 ",-1))]),_:1},8,["loading"]),l(o)?(c(),u("div",oe," 显示 "+r(l(S)?.length||0)+" / "+r(l(j)?.length||0)+" 条记录 ",1)):g("",!0)]),_:1})]),a(x,null,{default:i(()=>[a(tt,{pagination:l(v),"onUpdate:pagination":t[3]||(t[3]=m=>V(v)?v.value=m:null),columns:X,"data-source":l(S),loading:l(b),scroll:{x:800},"row-key":m=>m._uuid,size:"small"},{bodyCell:i(({column:m,record:C})=>[m.key==="function"?(c(),u("div",le,[s("div",ae,[U(C.stack_trace).length>0?(c(),u("span",ie,r(U(C.stack_trace)[0].func),1)):(c(),u("span",ce,r(C.top_function),1))]),C.stack_trace&&U(C.stack_trace).length>0?(c(),u("div",re,[(c(!0),u(G,null,J(U(C.stack_trace),(I,et)=>(c(),u("div",{key:et,class:"font-mono"},[s("span",de,r(I.func),1),I.file?(c(),u("br",ue)):g("",!0),I.file?(c(),u("span",_e,r(I.file)+r(I.line?`:${I.line}`:""),1)):g("",!0)]))),128))])):g("",!0)])):g("",!0),m.key==="action"?(c(),O(z,{key:1,type:"link",size:"small",onClick:I=>Z(C)},{default:i(()=>[...t[11]||(t[11]=[B(" 查看 ",-1)])]),_:1},8,["onClick"])):g("",!0)]),emptyText:i(()=>[s("div",pe,[a(l(N),{class:"text-4xl text-gray-300 mb-2"}),t[12]||(t[12]=s("p",{class:"text-gray-500"}," 暂无堆内存数据 ",-1))])]),_:1},8,["pagination","data-source","loading","row-key"])]),_:1}),a(qt,{visible:l(d),"onUpdate:visible":t[4]||(t[4]=m=>V(d)?d.value=m:null),entry:l(p),onClose:K},null,8,["visible","entry"])])}}}),be=Q(me,[["__scopeId","data-v-1d24b5c7"]]);export{be as default};

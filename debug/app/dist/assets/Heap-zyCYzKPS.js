import{_ as st}from"./ControlsWrapper.vue_vue_type_script_setup_true_lang-BHGW4-rT.js";import{f as z,c as nt}from"./useApi-Ci9ikep3.js";import{v as ot,j as P,U as D,V as lt,S as W,o as at,f as it,a as N,q as ct,r as dt,W as rt,p as ut,R as _t,u as mt,P as yt}from"./ant-design-vue-DhOu_vW1.js";import{d as q,U as O,W as i,V as c,Y as u,a4 as p,k as a,X as n,$ as d,u as l,G as B,F as G,Z as J,f as L,r as pt,c as E,w as gt,o as xt,b as ft,H as R,l as vt}from"./vue-vendor-CHXvf8H0.js";import{_ as Q}from"./index-C3c8jOCC.js";const _=[];for(let e=0;e<256;++e)_.push((e+256).toString(16).slice(1));function bt(e,o=0){return(_[e[o+0]]+_[e[o+1]]+_[e[o+2]]+_[e[o+3]]+"-"+_[e[o+4]]+_[e[o+5]]+"-"+_[e[o+6]]+_[e[o+7]]+"-"+_[e[o+8]]+_[e[o+9]]+"-"+_[e[o+10]]+_[e[o+11]]+_[e[o+12]]+_[e[o+13]]+_[e[o+14]]+_[e[o+15]]).toLowerCase()}let M;const ht=new Uint8Array(16);function kt(){if(!M){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");M=crypto.getRandomValues.bind(crypto)}return M(ht)}const wt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:wt};function St(e,o,v){e=e||{};const y=e.random??e.rng?.()??kt();if(y.length<16)throw new Error("Random bytes length must be >= 16");return y[6]=y[6]&15|64,y[8]=y[8]&63|128,bt(y)}function $t(e,o,v){return F.randomUUID&&!e?F.randomUUID():St(e)}const Ct={key:0,class:"space-y-4"},It={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ut={class:"text-center"},jt={class:"text-lg font-bold text-blue-600"},Tt={class:"text-center"},zt={class:"text-lg font-bold text-green-600"},At={class:"text-center"},Lt={class:"text-lg font-bold text-orange-600"},Rt={class:"text-center"},Vt={class:"text-lg font-bold text-red-600"},Bt={class:"flex items-center space-x-2"},Dt={key:0,class:"space-y-2"},Mt={class:"flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium"},Ot={class:"flex-1 min-w-0"},Ht={class:"space-y-1"},Nt={class:"font-mono text-sm font-semibold text-gray-900"},Et={key:0,class:"font-mono text-xs text-gray-600 pl-4 border-l-2 border-gray-300"},Ft={key:0,class:"text-xs text-blue-600 mt-2 font-medium"},Pt={key:1,class:"text-center py-8 text-gray-500"},Wt=q({__name:"StackTraceModal",props:{visible:{type:Boolean},entry:{}},emits:["update:visible","close"],setup(e,{emit:o}){const v=o;function y(){v("update:visible",!1),v("close")}return(V,r)=>{const g=P,h=lt,k=at,x=W,I=ot;return c(),O(I,{open:e.visible,title:"函数调用栈详情",footer:null,width:"900px",onCancel:y},{default:i(()=>[e.entry?(c(),u("div",Ct,[a(g,{size:"small",title:"分配统计"},{default:i(()=>[n("div",It,[n("div",Ut,[n("div",jt,d(e.entry.inuse_objects.toLocaleString()),1),r[0]||(r[0]=n("div",{class:"text-sm text-gray-600"}," 使用中对象 ",-1))]),n("div",Tt,[n("div",zt,d(l(z)(e.entry.inuse_bytes)),1),r[1]||(r[1]=n("div",{class:"text-sm text-gray-600"}," 使用中内存 ",-1))]),n("div",At,[n("div",Lt,d(e.entry.alloc_objects.toLocaleString()),1),r[2]||(r[2]=n("div",{class:"text-sm text-gray-600"}," 总分配对象 ",-1))]),n("div",Rt,[n("div",Vt,d(l(z)(e.entry.alloc_bytes)),1),r[3]||(r[3]=n("div",{class:"text-sm text-gray-600"}," 总分配内存 ",-1))])])]),_:1}),a(g,{size:"small",title:"主要函数"},{default:i(()=>[n("div",Bt,[a(l(D),{class:"text-blue-500"}),a(h,{code:"",class:"text-base"},{default:i(()=>[B(d(e.entry.top_function),1)]),_:1})])]),_:1}),a(g,{size:"small"},{title:i(()=>[a(x,null,{default:i(()=>[a(l(D)),r[4]||(r[4]=n("span",null,"完整调用栈",-1)),e.entry.stack_trace.length>0?(c(),O(k,{key:0,color:"blue"},{default:i(()=>[B(d(e.entry.stack_trace.length)+" 层 ",1)]),_:1})):p("",!0)]),_:1})]),default:i(()=>[e.entry.stack_trace.length>0?(c(),u("div",Dt,[(c(!0),u(G,null,J(e.entry.stack_trace,(U,w)=>(c(),u("div",{key:w,class:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[n("div",Mt,d(w+1),1),n("div",Ot,[n("div",Ht,[n("div",Nt,d(U.split(`
`)[0]),1),U.includes(`
`)?(c(),u("div",Et,d(U.split(`
`)[1]?.trim()),1)):p("",!0)]),w===0?(c(),u("div",Ft," ← 分配点 ")):p("",!0)])]))),128))])):(c(),u("div",Pt,[a(l(D),{class:"text-4xl mb-2"}),r[5]||(r[5]=n("p",null,"暂无调用栈信息",-1))]))]),_:1})])):p("",!0)]),_:1},8,["open"])}}}),qt=Q(Wt,[["__scopeId","data-v-c290c5f5"]]),Gt={class:"heap-page"},Jt={class:"mb-6"},Qt={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},Xt={class:"text-center"},Yt={class:"text-2xl font-bold text-blue-600"},Zt={class:"text-center"},Kt={class:"text-2xl font-bold text-green-600"},te={class:"text-center"},ee={class:"text-2xl font-bold text-orange-600"},se={class:"text-center"},ne={class:"text-2xl font-bold text-red-600"},oe={key:0,class:"text-sm text-gray-500"},le={key:0,class:"space-y-1"},ae={class:"font-medium text-sm text-black"},ie={key:0},ce={key:1},de={key:0,class:"text-xs text-gray-600 space-y-0.5"},re={class:"text-blue-600"},ue={key:0},_e={key:1,class:"text-gray-500"},me={class:"py-8 text-center"},ye=q({__name:"Heap",setup(e){const{data:o,loading:v,execute:y}=nt(),V=L(null),r=L(!1),g=L(""),h=L(void 0),k=L(void 0),x=pt({current:1,pageSize:50,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,t)=>`第 ${t[0]}-${t[1]} 条，共 ${s} 条`,pageSizeOptions:["50","100","200","500"],onChange:(s,t)=>{x.current=s,x.pageSize=t},onShowSizeChange:(s,t)=>{x.current=1,x.pageSize=t}});function I(s){if(!s||s.length===0)return[];const t=[];for(let S=0;S<Math.min(s.length,2);S++){const b=s[S];if(b)if(b.includes(`
`)){const f=b.split(`
`),A=f[0]?.trim(),j=f[1]?.trim();if(A&&j){const T=j.match(/^(.+\.go):(\d+)$/);T?t.push({file:T[1],line:T[2],func:A}):t.push({file:j,line:"",func:A})}}else t.push({file:"",line:"",func:b})}return t}const U=E(()=>(o.value?.entries||[]).map(t=>({...t,_uuid:$t()}))),w=E(()=>U.value?.filter(s=>{const t=!g.value||s.top_function?.toLowerCase().includes(g.value.toLowerCase())||s.stack_trace?.some(f=>f.toLowerCase().includes(g.value.toLowerCase())),S=h.value===void 0||s.inuse_bytes>=h.value,b=k.value===void 0||s.inuse_objects>=k.value;return t&&S&&b})||[]);gt(w,s=>{x.total=s?.length||0},{immediate:!0});const X=[{title:"函数",dataIndex:"top_function",key:"function",width:400,ellipsis:!1},{title:"使用中对象",dataIndex:"inuse_objects",key:"inuse_objects",width:120,align:"right",customRender:({text:s})=>s.toLocaleString(),sorter:(s,t)=>s.inuse_objects-t.inuse_objects},{title:"使用中内存",dataIndex:"inuse_bytes",key:"inuse_bytes",width:120,align:"right",customRender:({text:s})=>z(s),sorter:(s,t)=>s.inuse_bytes-t.inuse_bytes},{title:"总分配对象",dataIndex:"alloc_objects",key:"alloc_objects",width:120,align:"right",customRender:({text:s})=>s.toLocaleString(),sorter:(s,t)=>s.alloc_objects-t.alloc_objects},{title:"总分配内存",dataIndex:"alloc_bytes",key:"alloc_bytes",width:120,align:"right",customRender:({text:s})=>z(s),sorter:(s,t)=>s.alloc_bytes-t.alloc_bytes},{title:"内存占比",key:"memory_percentage",width:120,align:"center",customRender:({record:s})=>{if(!o.value)return"0%";const t=s.inuse_bytes/o.value.total_inuse_bytes*100;return vt(yt,{percent:Math.round(t*100)/100,size:"small",showInfo:!1,strokeColor:t>10?"#ff4d4f":t>5?"#faad14":"#52c41a"})}},{title:"操作",key:"action",width:80,align:"center"}];async function H(){await y()}xt(()=>{y()});const Y=setInterval(()=>{v.value||H()},3e4);ft(()=>{clearInterval(Y)});function Z(s){V.value=s,r.value=!0}function K(){r.value=!1,V.value=null}return(s,t)=>{const S=W,b=it,f=P,A=ct,j=rt,T=ut,tt=mt;return c(),u("div",Gt,[n("div",Jt,[a(b,{level:2,class:"mb-4"},{default:i(()=>[a(S,null,{default:i(()=>[a(l(N)),t[5]||(t[5]=n("span",null,"堆内存分析",-1))]),_:1})]),_:1}),l(o)?(c(),u("div",Qt,[a(f,{size:"small"},{default:i(()=>[n("div",Xt,[n("div",Yt,d(l(o).total_inuse_objects.toLocaleString()),1),t[6]||(t[6]=n("div",{class:"text-sm text-gray-600"}," 使用中对象 ",-1))])]),_:1}),a(f,{size:"small"},{default:i(()=>[n("div",Zt,[n("div",Kt,d(l(z)(l(o).total_inuse_bytes)),1),t[7]||(t[7]=n("div",{class:"text-sm text-gray-600"}," 使用中内存 ",-1))])]),_:1}),a(f,{size:"small"},{default:i(()=>[n("div",te,[n("div",ee,d(l(o).total_alloc_objects.toLocaleString()),1),t[8]||(t[8]=n("div",{class:"text-sm text-gray-600"}," 总分配对象 ",-1))])]),_:1}),a(f,{size:"small"},{default:i(()=>[n("div",se,[n("div",ne,d(l(z)(l(o).total_alloc_bytes)),1),t[9]||(t[9]=n("div",{class:"text-sm text-gray-600"}," 总分配内存 ",-1))])]),_:1})])):p("",!0),a(st,null,{default:i(()=>[a(A,{value:l(g),"onUpdate:value":t[0]||(t[0]=m=>R(g)?g.value=m:null),placeholder:"搜索函数名或文件路径",style:{width:"280px"},"allow-clear":""},{prefix:i(()=>[a(l(dt))]),_:1},8,["value"]),a(j,{value:l(h),"onUpdate:value":t[1]||(t[1]=m=>R(h)?h.value=m:null),placeholder:"最小内存(字节)",style:{width:"180px"},min:0,"allow-clear":""},null,8,["value"]),a(j,{value:l(k),"onUpdate:value":t[2]||(t[2]=m=>R(k)?k.value=m:null),placeholder:"最小对象数",style:{width:"150px"},min:0,"allow-clear":""},null,8,["value"]),a(T,{type:"primary",loading:l(v),onClick:H},{icon:i(()=>[a(l(_t))]),default:i(()=>[t[10]||(t[10]=B(" 刷新数据 ",-1))]),_:1},8,["loading"]),l(o)?(c(),u("div",oe," 显示 "+d(l(w)?.length||0)+" / "+d(l(U)?.length||0)+" 条记录 ",1)):p("",!0)]),_:1})]),a(f,null,{default:i(()=>[a(tt,{pagination:l(x),"onUpdate:pagination":t[3]||(t[3]=m=>R(x)?x.value=m:null),columns:X,"data-source":l(w),loading:l(v),scroll:{x:800},"row-key":m=>m._uuid,size:"small"},{bodyCell:i(({column:m,record:$})=>[m.key==="function"?(c(),u("div",le,[n("div",ae,[I($.stack_trace).length>0?(c(),u("span",ie,d(I($.stack_trace)[0].func),1)):(c(),u("span",ce,d($.top_function),1))]),$.stack_trace&&I($.stack_trace).length>0?(c(),u("div",de,[(c(!0),u(G,null,J(I($.stack_trace),(C,et)=>(c(),u("div",{key:et,class:"font-mono"},[n("span",re,d(C.func),1),C.file?(c(),u("br",ue)):p("",!0),C.file?(c(),u("span",_e,d(C.file)+d(C.line?`:${C.line}`:""),1)):p("",!0)]))),128))])):p("",!0)])):p("",!0),m.key==="action"?(c(),O(T,{key:1,type:"link",size:"small",onClick:C=>Z($)},{default:i(()=>[...t[11]||(t[11]=[B(" 查看 ",-1)])]),_:1},8,["onClick"])):p("",!0)]),emptyText:i(()=>[n("div",me,[a(l(N),{class:"text-4xl text-gray-300 mb-2"}),t[12]||(t[12]=n("p",{class:"text-gray-500"}," 暂无堆内存数据 ",-1))])]),_:1},8,["pagination","data-source","loading","row-key"])]),_:1}),a(qt,{visible:l(r),"onUpdate:visible":t[4]||(t[4]=m=>R(r)?r.value=m:null),entry:l(V),onClose:K},null,8,["visible","entry"])])}}}),be=Q(ye,[["__scopeId","data-v-1d24b5c7"]]);export{be as default};
